DROP TABLE STUDENTS CASCADE CONSTRAINTS;
DROP TABLE EXAM_RESULT CASCADE CONSTRAINTS;
DROP TABLE SUBJECT_NAME CASCADE CONSTRAINTS;
DROP TABLE ATTENDENCE CASCADE CONSTRAINTS;
DROP TABLE SECURITY CASCADE CONSTRAINTS;
CREATE TABLE STUDENTS(
	STUDENT_ID VARCHAR (10) NOT NULL,
	CLASS_ID INTEGER,
	FNAME VARCHAR(20),
	LNAME VARCHAR(20),
	DOB DATE,
	PHONE VARCHAR(15),
	JOIN_DATE DATE
);

CREATE TABLE EXAM_RESULT(
STUDENT_ID VARCHAR(10) NOT NULL,
CLASS_ID INTEGER,
SUBJECT_ID VARCHAR(10),
MARKS INTEGER,
GRADE VARCHAR(5)
);

CREATE TABLE SUBJECT_NAME(
STUDENT_ID VARCHAR(10) NOT NULL,
SUBJECT_ID VARCHAR(10)
);

CREATE TABLE ATTENDENCE(
STUDENT_ID VARCHAR(10) NOT NULL,
P_DATE DATE,
bool char check (bool in ('N','Y'))
);

create table SECURITY(
    user_id varchar(20),
    password varchar(20)
);

ALTER TABLE STUDENTS ADD CONSTRAINT SIP_KEY PRIMARY KEY(STUDENT_ID);
ALTER TABLE EXAM_RESULT ADD CONSTRAINT EXAM_KEY FOREIGN KEY(STUDENT_ID) REFERENCES STUDENTS(STUDENT_ID);
ALTER TABLE SUBJECT_NAME ADD CONSTRAINT SUBNAME_KEY FOREIGN KEY(STUDENT_ID) REFERENCES STUDENTS(STUDENT_ID);
ALTER TABLE ATTENDENCE ADD CONSTRAINT ATTEND_KEY FOREIGN KEY(STUDENT_ID) REFERENCES STUDENTS(STUDENT_ID);


INSERT INTO STUDENTS VALUES('ONE001',1,'MAHEDI','HASAN','03-JUL-1994','01839772045','01-JAN-2007');
INSERT INTO STUDENTS VALUES('ONE002',1,'TOUKIR','TUHIN','05-AUG-1995','018********','02-JAN-2007');
INSERT INTO STUDENTS VALUES('ONE003',1,'SUBASIS','HALDER','12-JAN-1996','017********','05-APR-2007');
INSERT INTO STUDENTS VALUES('TWO001',2,'SAKIB','FUAD','19-NOV-1994','015********','01-FEB-2007');
INSERT INTO STUDENTS VALUES('TWO002',2,'SAM','SOURABH','28-JUN-1995','019********','02-APR-2007');
INSERT INTO STUDENTS VALUES('TWO003',2,'HEMA','PRIO','19-AUG-1995','018********','13-MAR-2007');
INSERT INTO STUDENTS VALUES('THREE001',3,'TUSHER','PRANTO','19-AUG-1995','018********','13-MAR-2007');

INSERT INTO SUBJECT_NAME VALUES ('ONE001','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('ONE001','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('ONE001','MATH');
INSERT INTO SUBJECT_NAME VALUES ('ONE001','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('ONE001','ARTS');

INSERT INTO SUBJECT_NAME VALUES ('ONE002','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('ONE002','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('ONE002','MATH');
INSERT INTO SUBJECT_NAME VALUES ('ONE002','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('ONE002','ARTS');

INSERT INTO SUBJECT_NAME VALUES ('ONE003','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('ONE003','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('ONE003','MATH');
INSERT INTO SUBJECT_NAME VALUES ('ONE003','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('ONE003','ARTS');

INSERT INTO SUBJECT_NAME VALUES ('TWO001','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('TWO001','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('TWO001','MATH');
INSERT INTO SUBJECT_NAME VALUES ('TWO001','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('TWO001','ARTS');

INSERT INTO SUBJECT_NAME VALUES ('TWO002','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('TWO002','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('TWO002','MATH');
INSERT INTO SUBJECT_NAME VALUES ('TWO002','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('TWO002','ARTS');

INSERT INTO SUBJECT_NAME VALUES ('TWO003','BANGLA');
INSERT INTO SUBJECT_NAME VALUES ('TWO003','ENGLISH');
INSERT INTO SUBJECT_NAME VALUES ('TWO003','MATH');
INSERT INTO SUBJECT_NAME VALUES ('TWO003','SCIENCE');
INSERT INTO SUBJECT_NAME VALUES ('TWO003','ARTS');


CREATE or REPLACE TRIGGER TR_GRADE
BEFORE UPDATE OR INSERT ON EXAM_RESULT
FOR EACH ROW 

BEGIN

  IF :NEW.MARKS >=80 and :NEW.MARKS <= 100  THEN
    :NEW.GRADE := 'A+';

  ELSIF :NEW.MARKS >=70 and :NEW.MARKS <= 79  THEN
    :NEW.GRADE := 'A';

  ELSIF :NEW.MARKS >=60 and :NEW.MARKS <= 69  THEN
    :NEW.GRADE := 'A-';

  ELSIF :NEW.MARKS >=50 and :NEW.MARKS <= 59  THEN
    :NEW.GRADE := 'B';

  ELSIF :NEW.MARKS >=40 and :NEW.MARKS <= 49  THEN
    :NEW.GRADE := 'C';

  ELSIF :NEW.MARKS >=33 and :NEW.MARKS <= 39  THEN
    :NEW.GRADE := 'D';

  ELSIF :NEW.MARKS >=0 and :NEW.MARKS <= 32 THEN
    :NEW.GRADE := 'FAIL';
  
  END IF;
END TR_GRADE;
/
SHOW ERRORS;



INSERT INTO EXAM_RESULT VALUES ('ONE001',1,'BANGLA',70,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE001',1,'ENGLISH',45,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE001',1,'MATH',80,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE001',1,'SCIENCE',60,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE001',1,'ARTS',21,'NULL');

INSERT INTO EXAM_RESULT VALUES ('ONE002',1,'BANGLA',65,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE002',1,'ENGLISH',89,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE002',1,'MATH',51,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE002',1,'SCIENCE',78,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE002',1,'ARTS',40,'NULL');

INSERT INTO EXAM_RESULT VALUES ('ONE003',1,'BANGLA',45,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE003',1,'ENGLISH',81,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE003',1,'MATH',35,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE003',1,'SCIENCE',99,'NULL');
INSERT INTO EXAM_RESULT VALUES ('ONE003',1,'ARTS',61,'NULL');

INSERT INTO EXAM_RESULT VALUES ('TWO001',2,'BANGLA',71,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO001',2,'ENGLISH',86,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO001',2,'MATH',69,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO001',2,'SCIENCE',35,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO001',2,'ARTS',56,'NULL');

INSERT INTO EXAM_RESULT VALUES ('TWO002',2,'BANGLA',90,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO002',2,'ENGLISH',79,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO002',2,'MATH',70,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO002',2,'SCIENCE',93,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO002',2,'ARTS',21,'NULL');

INSERT INTO EXAM_RESULT VALUES ('TWO003',2,'BANGLA',90,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO003',2,'ENGLISH',24,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO003',2,'MATH',55,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO003',2,'SCIENCE',65,'NULL');
INSERT INTO EXAM_RESULT VALUES ('TWO003',2,'ARTS',71,'NULL');



INSERT INTO ATTENDENCE VALUES ('ONE001','01-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','02-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','03-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','04-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('ONE001','05-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('ONE001','06-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','07-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','08-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','09-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('ONE001','10-JUL-2017','N');

INSERT INTO ATTENDENCE VALUES ('ONE002','01-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','02-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','03-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','04-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE002','05-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE002','06-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','07-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','08-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE002','09-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE002','10-JUL-201','Y');

INSERT INTO ATTENDENCE VALUES ('ONE003','01-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE003','02-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','03-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE003','04-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','05-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','06-JUL-201','N');
INSERT INTO ATTENDENCE VALUES ('ONE003','07-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','08-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','09-JUL-201','Y');
INSERT INTO ATTENDENCE VALUES ('ONE003','10-JUL-201','Y');

INSERT INTO ATTENDENCE VALUES ('TWO001','01-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO001','02-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO001','03-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO001','04-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO001','05-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO001','06-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO001','07-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO001','08-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO001','09-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO001','10-JUL-2017','Y');

INSERT INTO ATTENDENCE VALUES ('TWO002','01-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','02-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','03-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','04-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','05-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','06-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO002','07-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','08-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','09-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO002','10-JUL-2017','Y');

INSERT INTO ATTENDENCE VALUES ('TWO003','01-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','02-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','03-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO003','04-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','05-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','06-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','07-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('TWO003','08-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','09-JUL-2017','N');
INSERT INTO ATTENDENCE VALUES ('TWO003','10-JUL-2017','Y');

INSERT INTO ATTENDENCE VALUES ('THREE001','09-JUL-2017','Y');
INSERT INTO ATTENDENCE VALUES ('THREE001','10-JUL-2017','Y');

INSERT INTO SECURITY VALUES('MAHEDI','1407005');

COMMIT;


------------------------------- LOG IN ---------------------------------------

PROMPT You need to login first..
PROMPT Enter your user id and password..

SET SERVEROUTPUT ON
DECLARE
   row NUMBER(2);
   USER SECURITY.user_id%TYPE;
   PASS SECURITY.password%TYPE;
BEGIN
    USER := '&user_id';
    PASS := '&password';

    select count(*) into row from SECURITY
    where SECURITY.user_id=USER and SECURITY.password=PASS;

    if row = 1 then
      dbms_output.put_line ('Welcome, Log in successful');
    else
      dbms_output.put_line ('Id or password do not match');
    end if;  

    EXCEPTION
      WHEN others THEN
        NULL;
END;
/


------------------studens list show by cursor----------------

PROMPT STUDENTS LIST SHOW BY CURSOR..

PAUSE Press ENTER to continue 1 ...

SET SERVEROUTPUT ON;
DECLARE
      CURSOR STU_cur IS
        select STUDENT_ID,CLASS_ID,FNAME,LNAME,DOB,PHONE,JOIN_DATE from STUDENTS;
        STU_t  STU_cur%ROWTYPE;
        counter NUMBER;
        count1  NUMBER;

   BEGIN
  	counter:=0;
    select count(STUDENT_ID) into count1 from STUDENTS;
     OPEN  STU_cur;
     LOOP
     FETCH STU_cur INTO STU_t;
     counter := counter + 1;
     EXIT WHEN counter > count1; 

    DBMS_OUTPUT.PUT_LINE ('STUDENT_ID : ' || STU_t.STUDENT_ID ||' CLASS_ID : ' ||  STU_t.CLASS_ID ||' FNAME : '|| STU_t.FNAME|| ' LNAME : ' || STU_t.DOB || ' PHONE : ' || STU_t.PHONE || ' and JOIN DATE : ' || STU_t.JOIN_DATE);
      DBMS_OUTPUT.PUT_LINE('');
      END LOOP;
      CLOSE STU_cur;
end;
/


---------------------------SUBJECT NAME ---------------------------------
PROMPT SEE STUDENTS DETAILS BELONG TO WHAT SUBJECTS..

PAUSE Press ENTER to continue 2 ...

select students.fname, students.student_id, students.class_id,subject_name.subject_id
from students left join subject_name on  subject_name.student_id=students.student_id;


----------------------------------ATTENDENCE------------------------------

PROMPT ENTER A STUDENT_ID FOR ATTENDENCE ..
select * from ATTENDENCE where STUDENT_ID = '&STUDENT_ID';

PROMPT Enter a CLASS_ID TO SEE ALL STUDENTS ATTENDENCE..
select * FROM ATTENDENCE WHERE STUDENT_ID IN (select STUDENT_ID FROM STUDENTS WHERE CLASS_ID=&CLASS_ID);

PROMPT ENTER A CLASS_ID TO SEE ALL STUDENTS PRESENTENCE

select STUDENT_ID, COUNT(STUDENT_ID) AS PRESENT FROM ATTENDENCE 
WHERE BOOL='Y' AND STUDENT_ID IN (select STUDENT_ID FROM STUDENTS WHERE CLASS_ID=&CLASS_ID) GROUP BY STUDENT_ID ORDER BY STUDENT_ID;

PROMPT ENTER STUDENT_ID TO SEE THE Percentence OF ATTENDENCE..

CREATE OR REPLACE PROCEDURE total_present IS
	sid ATTENDENCE.STUDENT_ID%TYPE;
   	row NUMBER(2);
   	count1 NUMBER(10);
   	result NUMBER(5,3);
BEGIN
	sid := '&STUDENT_ID';
	select count(*) into row from ATTENDENCE where STUDENT_ID = sid;
	dbms_output.put_line(' TOTAL CLASS '||row);
	select count(*) into count1 from ATTENDENCE where bool = 'Y' and STUDENT_ID = sid;
	dbms_output.put_line(' PRESENTS '||count1);
    result := (100 * count1)/row;
    dbms_output.put_line(' Percentence FOR ' || sid ||' IS '|| result ||'%');
END total_present;
/

SHOW ERRORS
SET SERVEROUTPUT ON
BEGIN
   total_present;
END;
/


PROMPT INSERT STUDENT ATTENDENCE TO SEE NEW ATTENDENCE..

CREATE OR REPLACE PROCEDURE add_attendence IS
  	row NUMBER(2);
   	count1 NUMBER(10);
   	result NUMBER(5,3);
    sid ATTENDENCE.STUDENT_ID%TYPE;
	PRESENT ATTENDENCE.P_DATE%TYPE;
    BOOL  ATTENDENCE.BOOL%TYPE; 
BEGIN
  sid :='&STUDENT_ID';
  PRESENT :='&P_DATE';
  BOOL :='&BOOL';
  INSERT INTO ATTENDENCE
  VALUES (sid,PRESENT,BOOL);
  select count(*) into row from ATTENDENCE where STUDENT_ID = sid;
	dbms_output.put_line(' TOTAL CLASS '||row);
	select count(*) into count1 from ATTENDENCE where bool = 'Y' and STUDENT_ID = sid;
	dbms_output.put_line(' PRESENTS '||count1);
    result := (100 * count1)/row;
    dbms_output.put_line(' Percentence FOR ' || sid ||' IS '|| result ||'%');
END add_attendence;
/

SHOW ERRORS
SET SERVEROUTPUT ON 
BEGIN
   add_attendence;
END;
/

----------------------------------------EXAM_RESULT-------------------------------------

PROMPT SEE MARKS OF A STUDENT..

select * from EXAM_RESULT where STUDENT_ID = '&STUDENT_ID';

PROMPT SEE MARKS OF A STUDENT  WITH SPECIFIC SUBJECT..

select * from EXAM_RESULT where STUDENT_ID = '&STUDENT_ID' and SUBJECT_ID = '&SUBJECT_ID';

PROMPT SEE THE MARKS OF A STUDENT USING FUNCTION..

CREATE OR REPLACE FUNCTION FIRST_ONE RETURN INTEGER IS
   MARK EXAM_RESULT.MARKS%type;
   
BEGIN
  SELECT MARKS INTO MARK FROM EXAM_RESULT 
  WHERE STUDENT_ID='&STUDENT_ID' AND CLASS_ID=&CLASS_ID AND SUBJECT_ID='&SUBJECT_ID';
   RETURN MARK;
END;
/

SET SERVEROUTPUT ON
BEGIN
dbms_output.put_line('MARKS IS = ' || FIRST_ONE);
END;
/


PROMPT  DELETE A TABLE CONTAINING PRIMARY KEY ..
PAUSE Press ENTER to continue 3 ...

ALTER TABLE EXAM_RESULT
DROP CONSTRAINT EXAM_KEY;
ALTER TABLE ATTENDENCE
DROP CONSTRAINT ATTEND_KEY;
ALTER TABLE SUBJECT_NAME
DROP CONSTRAINT SUBNAME_KEY;
ALTER TABLE STUDENTS
DROP CONSTRAINT SIP_KEY;
DELETE from STUDENTS;
SELECT * FROM STUDENTS;